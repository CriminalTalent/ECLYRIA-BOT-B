<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÌÅ¥ÎùºÎ¶¨Ïä§ Ïò§Î•¥ ÎçòÏ†Ñ Í¥ÄÎ¶¨Ïûê</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a1a;
            color: #fff;
            padding: 20px;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            color: #ff6b6b;
            margin-bottom: 30px;
            text-shadow: 0 0 10px rgba(255, 107, 107, 0.5);
        }
        
        .controls {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        label {
            color: #aaa;
            font-weight: bold;
        }
        
        select, input {
            padding: 8px 12px;
            background: #333;
            border: 1px solid #555;
            color: #fff;
            border-radius: 5px;
            font-size: 14px;
        }
        
        button {
            padding: 8px 16px;
            background: #ff6b6b;
            border: none;
            color: white;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        button:hover {
            background: #ff5252;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(255, 107, 107, 0.3);
        }
        
        button.secondary {
            background: #4a9eff;
        }
        
        button.secondary:hover {
            background: #3a8eef;
        }
        
        .map-container {
            background: #2a2a2a;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .map-title {
            font-size: 24px;
            color: #ff6b6b;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .map-info {
            font-size: 14px;
            color: #aaa;
        }
        
        .grid-editor {
            display: grid;
            grid-template-columns: 40px repeat(8, 70px);
            grid-template-rows: 40px repeat(8, 70px);
            gap: 3px;
            background: #1a1a1a;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .grid-cell {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 2px solid #333;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            font-size: 11px;
            padding: 5px;
        }
        
        .grid-cell:hover:not(.header-cell) {
            border-color: #ff6b6b;
            transform: scale(1.05);
        }
        
        .grid-cell.selected {
            border-color: #4a9eff;
            box-shadow: 0 0 10px rgba(74, 158, 255, 0.5);
        }
        
        .header-cell {
            background: #2a2a2a;
            color: #888;
            font-weight: bold;
            cursor: default;
            font-size: 14px;
        }
        
        .cell-wall {
            background: #444;
            color: #666;
        }
        
        .cell-corridor {
            background: #555;
            color: #aaa;
        }
        
        .cell-room {
            background: #3a5a3a;
            color: #9f9;
            border-color: #6f6;
        }
        
        .cell-entrance {
            background: #3a4a6a;
            color: #6bf;
            border-color: #4a9eff;
        }
        
        .coord-label {
            font-size: 9px;
            color: #666;
            position: absolute;
            top: 2px;
            left: 3px;
        }
        
        .cell-name {
            font-size: 10px;
            text-align: center;
            line-height: 1.2;
            word-break: keep-all;
        }
        
        .edit-panel {
            background: #333;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .edit-panel h3 {
            color: #4a9eff;
            margin-bottom: 15px;
        }
        
        .edit-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .form-group label {
            font-size: 12px;
        }
        
        .form-group input[type="text"] {
            width: 100%;
        }
        
        .form-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
        }
        
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            padding: 20px;
            background: #333;
            border-radius: 8px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .legend-box {
            width: 30px;
            height: 30px;
            border-radius: 4px;
            border: 2px solid #444;
        }
        
        .export-section {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 10px;
            margin-top: 30px;
        }
        
        .export-section h2 {
            color: #4a9eff;
            margin-bottom: 15px;
        }
        
        textarea {
            width: 100%;
            min-height: 200px;
            background: #1a1a1a;
            border: 1px solid #555;
            color: #9f9;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            border-radius: 5px;
            resize: vertical;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background: #4a9eff;
            color: white;
            border-radius: 5px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.3s;
            pointer-events: none;
            z-index: 1000;
        }
        
        .notification.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        .notification.success {
            background: #6bcf7f;
        }
        
        .notification.error {
            background: #ff6b6b;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üó∫Ô∏è ÌÅ¥ÎùºÎ¶¨Ïä§ Ïò§Î•¥ ÎçòÏ†Ñ Í¥ÄÎ¶¨Ïûê</h1>
        
        <!-- Ïª®Ìä∏Î°§ Ìå®ÎÑê -->
        <div class="controls">
            <div class="control-group">
                <label for="floorSelect">Ï∏µ ÏÑ†ÌÉù:</label>
                <select id="floorSelect">
                    <option value="B2">B2 - ÏßÄÌïò 2Ï∏µ (Ï¥àÍ∏â)</option>
                    <option value="B3">B3 - ÏßÄÌïò 3Ï∏µ (Ï§ëÍ∏â)</option>
                    <option value="B4">B4 - ÏßÄÌïò 4Ï∏µ (Í≥†Í∏â)</option>
                    <option value="B5">B5 - ÏßÄÌïò 5Ï∏µ (ÏµúÏÉÅÍ∏â)</option>
                </select>
            </div>
            
            <div class="control-group">
                <label for="cellTypeSelect">ÏÖÄ ÌÉÄÏûÖ:</label>
                <select id="cellTypeSelect">
                    <option value="wall">Î≤Ω (‚ñ†)</option>
                    <option value="corridor">Î≥µÎèÑ (-)</option>
                    <option value="room">Î∞© (‚ñ°)</option>
                    <option value="entrance">ÏûÖÍµ¨ (‚óã)</option>
                </select>
            </div>
            
            <div class="control-group">
                <button onclick="applyToSelected()">ÏÑ†ÌÉùÌïú ÏÖÄÏóê Ï†ÅÏö©</button>
                <button class="secondary" onclick="clearSelection()">ÏÑ†ÌÉù Ìï¥Ï†ú</button>
            </div>
        </div>
        
        <!-- Îßµ ÏóêÎîîÌÑ∞ -->
        <div class="map-container">
            <div class="map-title">
                <span id="mapTitle">ÏßÄÌïò 2Ï∏µ</span>
                <div class="map-info">
                    <span id="mapInfo">ÎÇúÏù¥ÎèÑ: 1 | Ï°∞ÏÇ¨: Ï°∞ÏÇ¨</span>
                </div>
            </div>
            
            <div id="gridEditor" class="grid-editor"></div>
            
            <!-- ÏÖÄ Ìé∏Ïßë Ìå®ÎÑê -->
            <div class="edit-panel" id="editPanel" style="display: none;">
                <h3>ÏÖÄ Ï†ïÎ≥¥ Ìé∏Ïßë: <span id="editCellCoord"></span></h3>
                <div class="edit-form">
                    <div class="form-group">
                        <label>ÌÉÄÏûÖ:</label>
                        <select id="editType">
                            <option value="wall">Î≤Ω</option>
                            <option value="corridor">Î≥µÎèÑ</option>
                            <option value="room">Î∞©</option>
                            <option value="entrance">ÏûÖÍµ¨</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Ïù¥Î¶Ñ:</label>
                        <input type="text" id="editName" placeholder="Ïòà: Ï∞ΩÍ≥†, ÌöåÏùòÏã§">
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="editInvestigatable">
                            Ï°∞ÏÇ¨ Í∞ÄÎä•
                        </label>
                    </div>
                    <div class="form-group">
                        <button onclick="saveCell()">Ï†ÄÏû•</button>
                        <button class="secondary" onclick="closeEditPanel()">Ï∑®ÏÜå</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Î≤îÎ°Ä -->
        <div class="legend">
            <div class="legend-item">
                <div class="legend-box" style="background: #444;"></div>
                <span>‚ñ† Î≤Ω</span>
            </div>
            <div class="legend-item">
                <div class="legend-box" style="background: #555;"></div>
                <span>- Î≥µÎèÑ</span>
            </div>
            <div class="legend-item">
                <div class="legend-box" style="background: #3a5a3a; border-color: #6f6;"></div>
                <span>‚ñ° Î∞© (Ï°∞ÏÇ¨ Í∞ÄÎä•)</span>
            </div>
            <div class="legend-item">
                <div class="legend-box" style="background: #3a4a6a; border-color: #4a9eff;"></div>
                <span>‚óã ÏûÖÍµ¨</span>
            </div>
        </div>
        
        <!-- ÎÇ¥Î≥¥ÎÇ¥Í∏∞/Î∂àÎü¨Ïò§Í∏∞ -->
        <div class="export-section">
            <h2>Ruby ÏΩîÎìú ÎÇ¥Î≥¥ÎÇ¥Í∏∞</h2>
            <textarea id="exportCode" readonly></textarea>
            <div class="button-group">
                <button onclick="generateRubyCode()">Ruby ÏΩîÎìú ÏÉùÏÑ±</button>
                <button class="secondary" onclick="copyToClipboard()">ÌÅ¥Î¶ΩÎ≥¥ÎìúÏóê Î≥µÏÇ¨</button>
                <button class="secondary" onclick="downloadRubyFile()">Ruby ÌååÏùº Îã§Ïö¥Î°úÎìú</button>
            </div>
        </div>
    </div>
    
    <!-- ÏïåÎ¶º -->
    <div id="notification" class="notification"></div>
    
    <script>
        // Îßµ Îç∞Ïù¥ÌÑ∞ Íµ¨Ï°∞
        const floorData = {
            B2: {
                name: 'ÏßÄÌïò 2Ï∏µ',
                difficulty: 1,
                investigation_type: 'Ï°∞ÏÇ¨',
                entrance: 'B2-F7',
                grid: {}
            },
            B3: {
                name: 'ÏßÄÌïò 3Ï∏µ',
                difficulty: 2,
                investigation_type: 'Ï†ïÎ∞ÄÏ°∞ÏÇ¨',
                entrance: 'B3-F7',
                grid: {}
            },
            B4: {
                name: 'ÏßÄÌïò 4Ï∏µ',
                difficulty: 3,
                investigation_type: 'Í∞êÏßÄ',
                entrance: 'B4-F7',
                grid: {}
            },
            B5: {
                name: 'ÏßÄÌïò 5Ï∏µ',
                difficulty: 4,
                investigation_type: 'ÌõîÏ≥êÎ≥¥Í∏∞',
                entrance: 'B5-F7',
                grid: {}
            }
        };
        
        let currentFloor = 'B2';
        let selectedCells = new Set();
        let currentEditCell = null;
        
        // Ï¥àÍ∏∞Ìôî
        function init() {
            initializeDefaultMaps();
            renderGrid();
            document.getElementById('floorSelect').addEventListener('change', (e) => {
                currentFloor = e.target.value;
                clearSelection();
                renderGrid();
            });
        }
        
        // Í∏∞Î≥∏ Îßµ Ï¥àÍ∏∞Ìôî
        function initializeDefaultMaps() {
            const cols = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H'];
            const rows = [1, 2, 3, 4, 5, 6, 7, 8];
            
            Object.keys(floorData).forEach(floor => {
                cols.forEach(col => {
                    rows.forEach(row => {
                        const coord = `${floor}-${col}${row}`;
                        floorData[floor].grid[coord] = {
                            type: 'corridor',
                            name: 'Î≥µÎèÑ',
                            investigatable: false
                        };
                    });
                });
                
                // Í∏∞Î≥∏ Î≤Ω ÏÑ§Ï†ï (ÌÖåÎëêÎ¶¨)
                cols.forEach(col => {
                    floorData[floor].grid[`${floor}-${col}1`].type = 'wall';
                    floorData[floor].grid[`${floor}-${col}1`].name = 'Î≤Ω';
                    floorData[floor].grid[`${floor}-${col}8`].type = 'wall';
                    floorData[floor].grid[`${floor}-${col}8`].name = 'Î≤Ω';
                });
                rows.forEach(row => {
                    floorData[floor].grid[`${floor}-A${row}`].type = 'wall';
                    floorData[floor].grid[`${floor}-A${row}`].name = 'Î≤Ω';
                    floorData[floor].grid[`${floor}-H${row}`].type = 'wall';
                    floorData[floor].grid[`${floor}-H${row}`].name = 'Î≤Ω';
                });
                
                // Í∏∞Î≥∏ ÏûÖÍµ¨
                floorData[floor].grid[`${floor}-F7`].type = 'entrance';
                floorData[floor].grid[`${floor}-F7`].name = 'ÏûÖÍµ¨';
            });
        }
        
        // Í∑∏Î¶¨Îìú Î†åÎçîÎßÅ
        function renderGrid() {
            const grid = document.getElementById('gridEditor');
            grid.innerHTML = '';
            
            const floor = floorData[currentFloor];
            document.getElementById('mapTitle').textContent = floor.name;
            document.getElementById('mapInfo').textContent = 
                `ÎÇúÏù¥ÎèÑ: ${floor.difficulty} | Ï°∞ÏÇ¨: ${floor.investigation_type}`;
            
            // Ìó§Îçî
            const emptyHeader = document.createElement('div');
            emptyHeader.className = 'grid-cell header-cell';
            grid.appendChild(emptyHeader);
            
            ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H'].forEach(col => {
                const header = document.createElement('div');
                header.className = 'grid-cell header-cell';
                header.textContent = col;
                grid.appendChild(header);
            });
            
            // Í∑∏Î¶¨Îìú ÏÖÄ
            for (let row = 1; row <= 8; row++) {
                const rowHeader = document.createElement('div');
                rowHeader.className = 'grid-cell header-cell';
                rowHeader.textContent = row;
                grid.appendChild(rowHeader);
                
                ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H'].forEach(col => {
                    const coord = `${currentFloor}-${col}${row}`;
                    const cellData = floor.grid[coord];
                    
                    const cell = document.createElement('div');
                    cell.className = `grid-cell cell-${cellData.type}`;
                    cell.dataset.coord = coord;
                    
                    if (selectedCells.has(coord)) {
                        cell.classList.add('selected');
                    }
                    
                    const coordLabel = document.createElement('span');
                    coordLabel.className = 'coord-label';
                    coordLabel.textContent = `${col}${row}`;
                    cell.appendChild(coordLabel);
                    
                    const cellName = document.createElement('span');
                    cellName.className = 'cell-name';
                    cellName.textContent = cellData.name;
                    cell.appendChild(cellName);
                    
                    cell.addEventListener('click', (e) => {
                        if (e.shiftKey) {
                            toggleSelection(coord);
                        } else {
                            openEditPanel(coord);
                        }
                    });
                    
                    grid.appendChild(cell);
                });
            }
        }
        
        // ÏÑ†ÌÉù ÌÜ†Í∏Ä
        function toggleSelection(coord) {
            if (selectedCells.has(coord)) {
                selectedCells.delete(coord);
            } else {
                selectedCells.add(coord);
            }
            renderGrid();
        }
        
        // ÏÑ†ÌÉù Ìï¥Ï†ú
        function clearSelection() {
            selectedCells.clear();
            renderGrid();
        }
        
        // ÏÑ†ÌÉùÌïú ÏÖÄÏóê Ï†ÅÏö©
        function applyToSelected() {
            if (selectedCells.size === 0) {
                showNotification('ÏÖÄÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî (Shift+ÌÅ¥Î¶≠)', 'error');
                return;
            }
            
            const cellType = document.getElementById('cellTypeSelect').value;
            const typeNames = {
                wall: 'Î≤Ω',
                corridor: 'Î≥µÎèÑ',
                room: 'Î∞©',
                entrance: 'ÏûÖÍµ¨'
            };
            
            selectedCells.forEach(coord => {
                floorData[currentFloor].grid[coord].type = cellType;
                floorData[currentFloor].grid[coord].name = typeNames[cellType];
                if (cellType === 'room') {
                    floorData[currentFloor].grid[coord].investigatable = true;
                } else {
                    floorData[currentFloor].grid[coord].investigatable = false;
                }
            });
            
            showNotification(`${selectedCells.size}Í∞ú ÏÖÄ ÏóÖÎç∞Ïù¥Ìä∏ ÏôÑÎ£å`, 'success');
            clearSelection();
        }
        
        // Ìé∏Ïßë Ìå®ÎÑê Ïó¥Í∏∞
        function openEditPanel(coord) {
            currentEditCell = coord;
            const cellData = floorData[currentFloor].grid[coord];
            
            document.getElementById('editCellCoord').textContent = coord.split('-')[1];
            document.getElementById('editType').value = cellData.type;
            document.getElementById('editName').value = cellData.name;
            document.getElementById('editInvestigatable').checked = cellData.investigatable || false;
            
            document.getElementById('editPanel').style.display = 'block';
        }
        
        // Ìé∏Ïßë Ìå®ÎÑê Îã´Í∏∞
        function closeEditPanel() {
            document.getElementById('editPanel').style.display = 'none';
            currentEditCell = null;
        }
        
        // ÏÖÄ Ï†ÄÏû•
        function saveCell() {
            if (!currentEditCell) return;
            
            const cellData = floorData[currentFloor].grid[currentEditCell];
            cellData.type = document.getElementById('editType').value;
            cellData.name = document.getElementById('editName').value;
            cellData.investigatable = document.getElementById('editInvestigatable').checked;
            
            showNotification('Ï†ÄÏû• ÏôÑÎ£å', 'success');
            closeEditPanel();
            renderGrid();
        }
        
        // Ruby ÏΩîÎìú ÏÉùÏÑ±
        function generateRubyCode() {
            let code = `'${currentFloor}' => {\n`;
            code += `  name: '${floorData[currentFloor].name}',\n`;
            code += `  difficulty: ${floorData[currentFloor].difficulty},\n`;
            code += `  investigation_type: '${floorData[currentFloor].investigation_type}',\n`;
            code += `  entrance: '${floorData[currentFloor].entrance}',\n`;
            code += `  grid: {\n`;
            
            const grid = floorData[currentFloor].grid;
            Object.keys(grid).sort().forEach(coord => {
                const cell = grid[coord];
                code += `    '${coord}' => { type: '${cell.type}', name: '${cell.name}'`;
                if (cell.investigatable) {
                    code += `, investigatable: true`;
                }
                code += ` },\n`;
            });
            
            code += `  }\n}`;
            
            document.getElementById('exportCode').value = code;
            showNotification('Ruby ÏΩîÎìú ÏÉùÏÑ± ÏôÑÎ£å', 'success');
        }
        
        // ÌÅ¥Î¶ΩÎ≥¥ÎìúÏóê Î≥µÏÇ¨
        function copyToClipboard() {
            const code = document.getElementById('exportCode').value;
            if (!code) {
                showNotification('Î®ºÏ†Ä ÏΩîÎìúÎ•º ÏÉùÏÑ±ÌïòÏÑ∏Ïöî', 'error');
                return;
            }
            
            navigator.clipboard.writeText(code).then(() => {
                showNotification('ÌÅ¥Î¶ΩÎ≥¥ÎìúÏóê Î≥µÏÇ¨Îê®', 'success');
            });
        }
        
        // Ruby ÌååÏùº Îã§Ïö¥Î°úÎìú
        function downloadRubyFile() {
            const code = document.getElementById('exportCode').value;
            if (!code) {
                showNotification('Î®ºÏ†Ä ÏΩîÎìúÎ•º ÏÉùÏÑ±ÌïòÏÑ∏Ïöî', 'error');
                return;
            }
            
            const blob = new Blob([code], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${currentFloor}_map.rb`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('ÌååÏùº Îã§Ïö¥Î°úÎìú ÏãúÏûë', 'success');
        }
        
        // ÏïåÎ¶º ÌëúÏãú
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        // Ï¥àÍ∏∞Ìôî Ïã§Ìñâ
        init();
    </script>
</body>
</html>
