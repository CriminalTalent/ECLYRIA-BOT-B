# Google Sheets 구조 상세 가이드

## 개요
이 문서는 배틀 봇이 사용하는 Google Sheets의 구조를 상세히 설명합니다.

## 시트 목록

### 1. 사용자 (Users Sheet)
캐릭터 정보와 스탯을 관리하는 시트입니다.

#### 열 구조
| 열 | 필드명 | 데이터 타입 | 필수 | 설명 |
|----|--------|-------------|------|------|
| A | ID | 텍스트 | O | 마스토돈 전체 계정명 (@user@server.com) |
| B | 이름 | 텍스트 | O | 캐릭터 또는 유저 닉네임 |
| C | 체력 | 정수 | O | 현재 HP (기본값: 100) |
| D | 공격력 | 정수 | O | 공격 스탯 (기본값: 10) |
| E | 마력 | 정수 | X | 마법 관련 스탯 (미사용) |
| F | 방어력 | 정수 | O | 방어 스탯 (기본값: 10) |
| G | 민첩 | 정수 | O | 민첩 스탯 (기본값: 10) |
| H | 행운 | 정수 | O | 행운 스탯 (기본값: 10) |
| I | 아이템 | 텍스트 | X | 소지 아이템 목록 (쉼표로 구분) |
| J | 마지막조사일 | 날짜 | X | 마지막 조사 날짜 (YYYY-MM-DD) |

#### 예시 데이터
```
ID                              이름      체력  공격력  마력  방어력  민첩  행운  아이템           마지막조사일
@user1@fortunaefons.masto.host  전사A     100   15      5     12      10    8     포션,검          2025-10-30
@user2@fortunaefons.masto.host  마법사B   80    8       20    6       12    15    포션,마법서      2025-10-29
```

#### 스탯 설명
- **체력**: 전투 시 HP, 0이 되면 전투 패배
- **공격력**: 공격 시 기본 공격력 (D20과 합산)
- **방어력**: 방어 시 기본 방어력 (D20과 합산)
- **민첩**: 선후공 결정, 도주 판정에 사용
- **행운**: 조사 판정에 보정값으로 사용

#### 아이템 형식
```
포션              # 단일 아이템
포션,검,방패      # 여러 아이템 (쉼표로 구분)
```

---

### 2. 조사 (Investigation Sheet)
조사 가능한 대상과 결과를 정의하는 시트입니다.

#### 열 구조
| 열 | 필드명 | 데이터 타입 | 필수 | 설명 |
|----|--------|-------------|------|------|
| A | 대상 | 텍스트 | O | 조사할 대상의 이름 |
| B | 종류 | 텍스트 | O | 조사/정밀조사/감지/훔쳐보기/DM조사 |
| C | 난이도 | 정수 | O | 성공 기준값 (행운+D20 >= 난이도) |
| D | 성공결과 | 텍스트 | O | 판정 성공 시 표시할 메시지 |
| E | 실패결과 | 텍스트 | O | 판정 실패 시 표시할 메시지 |

#### 조사 종류 설명
- **조사**: 기본 조사 (DM조사도 함께 검색됨)
- **정밀조사**: 더 상세한 조사
- **감지**: 감지 능력 사용
- **훔쳐보기**: 은밀한 관찰
- **DM조사**: DM 전용 항목 (일반 조사에서도 매칭)

#### 예시 데이터
```
대상          종류        난이도  성공결과                                실패결과
마법의 문     조사        15      당신은 고대 문자를 해독했습니다         문자가 너무 복잡합니다
비밀 통로     정밀조사    20      숨겨진 통로를 발견했습니다             아무것도 발견하지 못했습니다
어둠의 기운   감지        12      강력한 마법의 흔적을 감지했습니다       특별한 것을 느끼지 못했습니다
```

#### 난이도 가이드
| 난이도 범위 | 난이도 등급 | 설명 |
|------------|------------|------|
| 5-10 | 매우 쉬움 | 누구나 쉽게 성공 |
| 11-15 | 쉬움 | 보통 스탯으로 성공 가능 |
| 16-20 | 보통 | 행운 스탯이 필요 |
| 21-25 | 어려움 | 높은 행운 필요 |
| 26-30 | 매우 어려움 | 최상급 행운 필요 |
| 31+ | 거의 불가능 | 극히 희귀한 성공 |

---

## 시트 생성 가이드

### 1. 새 스프레드시트 생성
1. Google Sheets에서 새 스프레드시트 생성
2. 스프레드시트 ID 복사 (URL에서 확인)
   ```
   https://docs.google.com/spreadsheets/d/[여기가_ID]/edit
   ```

### 2. 시트 설정

#### 사용자 시트
1. 첫 번째 시트 이름을 "사용자"로 변경
2. 첫 행에 헤더 입력:
   ```
   ID | 이름 | 체력 | 공격력 | 마력 | 방어력 | 민첩 | 행운 | 아이템 | 마지막조사일
   ```

#### 조사 시트
1. 새 시트 추가, 이름을 "조사"로 변경
2. 첫 행에 헤더 입력:
   ```
   대상 | 종류 | 난이도 | 성공결과 | 실패결과
   ```

### 3. 권한 설정
1. Google Cloud Console에서 서비스 계정 생성
2. JSON 키 다운로드
3. 스프레드시트 공유 설정에서 서비스 계정 이메일 추가 (편집자 권한)

---

## 데이터 관리 팁

### 사용자 추가
봇이 자동으로 사용자를 추가하지 않으므로, 수동으로 추가해야 합니다:
```
@newuser@server.com | 신규유저 | 100 | 10 | 5 | 10 | 10 | 10 | 포션 | 
```

### 조사 항목 추가
새로운 조사 대상을 추가하려면 "조사" 시트에 행 추가:
```
새로운대상 | 조사 | 15 | 성공했을때메시지 | 실패했을때메시지
```

### 스탯 조정
캐릭터 스탯은 시트에서 직접 수정 가능합니다. 봇이 실시간으로 반영합니다.

### 백업 권장사항
- 정기적으로 시트 복사본 생성
- 중요 데이터는 별도 저장
- 버전 히스토리 활용

---

## 문제 해결

### 봇이 시트를 읽지 못하는 경우
1. 서비스 계정 이메일이 편집자로 추가되었는지 확인
2. GOOGLE_SHEET_ID가 올바른지 확인
3. credentials.json 파일 경로 확인

### 데이터가 업데이트되지 않는 경우
1. 시트 이름이 정확한지 확인 ("사용자", "조사")
2. 헤더 행이 첫 번째 행에 있는지 확인
3. 필수 열이 모두 존재하는지 확인

### 사용자를 찾을 수 없다는 오류
1. ID 형식 확인: `@username@server.com`
2. 대소문자 정확히 일치하는지 확인
3. 공백이 없는지 확인

---

## 시트 템플릿

아래 링크에서 템플릿을 복사할 수 있습니다:
(템플릿 링크는 직접 생성하여 공유하세요)

템플릿 사용법:
1. "파일 > 사본 만들기" 선택
2. 서비스 계정에 편집 권한 부여
3. .env 파일에 시트 ID 입력
