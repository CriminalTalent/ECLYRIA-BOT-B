# 클라리스 오르 탐색 시스템 가이드

## 🎯 시스템 개요

### 핵심 특징
- ✅ **개인/협력 진입**: 혼자 또는 최대 5명 협력
- ✅ **스레드 기반**: 타래(스레드) 단위로 진행
- ✅ **매일 초기화**: 다음날은 입구에서 재시작
- ✅ **랜덤 조우**: 위치마다 다른 적 출현
- ✅ **아이템 파밍**: 탐색 중 아이템 획득
- ✅ **조사 연동**: 단서 자동 발견

---

## 🚀 시작하기

### 개인 탐색
```
@Battle [탐색시작/B3]
```
**결과:**
```
========================================
지하 3층 탐색 시작
========================================

개인 탐색 모드

조사 유형: 정밀조사
적 조우율: 35%
아이템 발견율: 15%

이곳은 클라리스 오르 조직의 거점입니다.
탐색하며 단서를 찾고, 조직원을 처치하세요!

명령어:
[탐색] - 한 걸음 전진
[전투시작] - 조우한 적과 전투
[탐색상태] - 현재 상태 확인
[탐색종료] - 탐색 종료

💡 매일 입구에서 새로 시작합니다!
```

### 협력 탐색 (2-5명)
```
@Battle [협력탐색/B4/@Alice/@Bob/@Charlie]
```
**결과:**
```
========================================
지하 4층 탐색 시작
========================================

협력 탐색 모드 (3명)
@Alice @Bob @Charlie

조사 유형: 감지
적 조우율: 40%
아이템 발견율: 10%

이곳은 클라리스 오르 조직의 거점입니다.
탐색하며 단서를 찾고, 조직원을 처치하세요!
```

---

## 🗺️ 층별 정보

| 층 | 이름 | 난이도 | 조사 유형 | 적 조우율 | 아이템율 | 등장 적 |
|----|------|--------|-----------|-----------|----------|---------|
| B2 | 지하 2층 | 1 | 조사 | 30% | 20% | 활동가, 지지자 |
| B3 | 지하 3층 | 2 | 정밀조사 | 35% | 15% | 지지자, 집행자 |
| B4 | 지하 4층 | 3 | 감지 | 40% | 10% | 집행자, 간부, 정예 |
| B5 | 지하 5층 | 4 | 훔쳐보기 | 45% | 8% | 간부, 정예, 사령관 |

---

## 🚶 탐색 진행

### 기본 진행
```
@Battle [탐색]
```

### 탐색 결과 (예시 1: 단서 발견)
```
@Alice
Alice이(가) 전진합니다... (1 걸음)
위치: 긴 복도

========================================
🔍 단서 발견!
========================================
대상: 지하 3층 단서
판정: 15 + 행운 12 = 27
난이도: 15
결과: ✅ 성공

집행자의 작전 계획서를 발견했습니다!
클라리스 오르 조직의 다음 목표가 적혀있습니다.
[아이템:작전계획서] [갈레온:50]
========================================
```

### 탐색 결과 (예시 2: 아이템 파밍)
```
@Bob
Bob이(가) 전진합니다... (2 걸음)
위치: 어두운 방

========================================
📦 아이템 발견!
========================================
중형물약
인벤토리에 추가되었습니다.
========================================
```

### 탐색 결과 (예시 3: 적 조우)
```
@Charlie
Charlie이(가) 전진합니다... (3 걸음)
위치: 갈림길

========================================
⚔️ 적 조우!
========================================
클라리스 오르 혈통차별 집행자
HP: 70 / 공격: 5 / 방어: 4

[전투시작]으로 전투를 시작하세요!
========================================
```

### 탐색 결과 (예시 4: 아무것도 없음)
```
@Dave
Dave이(가) 전진합니다... (4 걸음)
위치: 좁은 통로

조용합니다. 아무것도 발견하지 못했습니다.
```

---

## ⚔️ 전투 시스템

### 전투 시작
```
@Battle [전투시작]
```
**조건:**
- 적과 조우한 상태여야 함
- 한 번에 한 명씩만 전투 가능

### 전투 진행
```
@Battle [공격]
@Battle [방어]
@Battle [반격]
@Battle [물약/소형]
@Battle [도주]
```

### 전투 승리
```
적을 처치했습니다!
경험치 +25

[탐색]을 계속하거나 [탐색종료]하세요.
```

---

## 📊 상태 확인

### 탐색 상태
```
@Battle [탐색상태]
```
**결과:**
```
@Alice
========================================
탐색 상태
========================================

장소: 지하 3층
참가자: 1명
진행: 5 걸음
현재 위치: 비밀 공간

발견한 단서: 2개
획득한 아이템: 3개
처치한 적: 1명

명령어: [탐색] [전투시작] [탐색종료] [탐색상태]
```

---

## 🏁 탐색 종료

### 종료 명령
```
@Battle [탐색종료]
```

### 종료 요약
```
========================================
탐색 종료
========================================

장소: 지하 3층
참가자: 1명
진행: 12 걸음
소요 시간: 450초

발견한 단서: 3개
획득한 아이템: 5개
처치한 적: 2명

수고하셨습니다!
```

---

## 🎲 확률 시스템

### 단서 발견 확률
| 층 | 기본 확률 | 판정 |
|----|----------|------|
| B2 | 25% | D20 + 행운 >= 10 |
| B3 | 20% | D20 + 행운 >= 15 |
| B4 | 15% | D20 + 행운 >= 20 |
| B5 | 10% | D20 + 행운 >= 25 |

### 아이템 파밍 확률
- B2: 20% (소형물약, 낡은 지도, 조직 배지)
- B3: 15% (중형물약, 암호문서, 마법 촉매)
- B4: 10% (중형물약, 대형물약, 비밀 열쇠, 마법서 조각)
- B5: 8% (대형물약, 전설의 유물, 고급 마법서)

### 적 조우 확률
- B2: 30%
- B3: 35%
- B4: 40%
- B5: 45%

---

## 🎭 클라리스 오르 조직원

### 조직원 종류
| 적 | HP | 공격 | 방어 | 민첩 | 행운 | 경험치 | 출현 층 |
|----|-----|------|------|------|------|--------|---------|
| 순혈주의 활동가 | 40 | 3 | 2 | 3 | 5 | 10 | B2 |
| 클라리스 지지자 | 50 | 4 | 3 | 4 | 6 | 15 | B2-B3 |
| 혈통차별 집행자 | 70 | 5 | 4 | 5 | 8 | 25 | B3-B4 |
| 클라리스 간부 | 90 | 6 | 5 | 6 | 10 | 35 | B4-B5 |
| 정예 순혈주의자 | 120 | 8 | 6 | 7 | 12 | 50 | B4-B5 |
| 클라리스 사령관 | 150 | 10 | 8 | 8 | 15 | 75 | B5 |

### 조직 설명
```
클라리스 오르(Clarisse Ore)
- 순혈주의를 주장하는 극단주의 조직
- 혈통 차별을 정당화하는 위험한 세력
- 지하에 거점을 두고 활동 중
```

---

## 📍 스레드 시스템

### 스레드 구조
```
최초 툿 (@Battle [탐색시작/B3])
  └─ 봇 응답 (탐색 시작)
      └─ 플레이어 (@Battle [탐색])
          └─ 봇 응답 (탐색 결과)
              └─ 플레이어 (@Battle [탐색])
                  └─ 봇 응답 (적 조우)
                      └─ 플레이어 (@Battle [전투시작])
                          └─ ...
```

### 스레드 장점
- 각 탐색마다 독립적인 타래
- 다른 탐색과 섞이지 않음
- 히스토리 추적 용이
- 동시 알림 없음 (같은 스레드 내)

---

## 🔄 매일 초기화

### 초기화 규칙
```
탐색 시작: 항상 입구(entrance)에서 시작
전날 위치: 초기화됨
전날 조우: 초기화됨
전날 아이템: 유지 (인벤토리)
전날 단서: 유지 (로그)
```

### 이어하기 예시
```
Day 1:
[탐색시작/B3]
→ 5걸음 진행
→ 적 2마리 처치
→ [탐색종료]

Day 2:
[탐색시작/B3]  # 다시 입구부터
→ 새로운 적 출현
→ 다른 위치, 다른 아이템
```

---

## 💡 전략 팁

### 개인 탐색
- 낮은 층(B2)에서 연습
- 물약 충분히 준비
- 행운 스탯 활용

### 협력 탐색
- 역할 분담 (탐색/전투)
- 아이템 공유
- 단서 정보 공유

### 효율적 파밍
- B2: 물약 파밍
- B3-B4: 중급 아이템
- B5: 희귀 아이템

### 전투 팁
- 적 조우 시 HP 확인
- 승산 없으면 [도주]
- 물약 아끼지 말기

---

## ⚙️ 통합 방법

### command_parser.rb 수정
```ruby
require_relative 'commands/exploration_command'

class CommandParser
  def initialize(mastodon_client, sheet_manager)
    # ...
    @exploration_command = ExplorationCommand.new(mastodon_client, sheet_manager)
  end

  def parse(user_id, text, status)
    # 탐색 명령어 체크
    if text =~ /\[(탐색시작|협력탐색|탐색|전투시작|탐색종료|탐색상태)\]/i
      @exploration_command.handle_command(user_id, text, status)
      return
    end
    
    # 기존 명령어들...
  end
end
```

---

## 🆚 공동목표 vs 탐색

### 공동목표 (기존)
- 8x8 맵, 고정 위치
- 30명 동시 참여
- 턴제 이동
- 레이드 보스

### 탐색 (신규)
- 랜덤 위치, 텍스트 기반
- 1-5명 참여
- 자유 진행
- 개인/협력 전투

### 동시 진행 가능
```
Alice: [탐색시작/B3]        (개인 탐색)
Bob: [공동목표/B4/...]       (공동목표 30인)
Charlie: [협력탐색/B2/@Dave] (협력 탐색)
```

---

## 📋 명령어 요약

| 명령어 | 설명 | 예시 |
|--------|------|------|
| `[탐색시작/층]` | 개인 탐색 시작 | `[탐색시작/B3]` |
| `[협력탐색/층/@참가자]` | 협력 탐색 시작 | `[협력탐색/B4/@Alice/@Bob]` |
| `[탐색]` | 한 걸음 전진 | `[탐색]` |
| `[전투시작]` | 조우한 적과 전투 | `[전투시작]` |
| `[탐색상태]` | 상태 확인 | `[탐색상태]` |
| `[탐색종료]` | 탐색 종료 | `[탐색종료]` |

---

## 🎬 시나리오 예시

### 개인 탐색
```
GM: "지하 3층에서 클라리스 오르의 비밀을 찾아라"

Alice: @Battle [탐색시작/B3]
Bot: 지하 3층 탐색 시작...

Alice: @Battle [탐색]
Bot: 긴 복도... 단서 발견! "집행자의 일지"

Alice: @Battle [탐색]
Bot: 어두운 방... 중형물약 획득!

Alice: @Battle [탐색]
Bot: 갈림길... 적 조우! 혈통차별 집행자!

Alice: @Battle [전투시작]
Bot: 전투 시작!

Alice: @Battle [공격]
Bot: 데미지 15! 적 HP 55/70

[전투 계속...]

Bot: 적을 처치했습니다! 경험치 +25

Alice: @Battle [탐색종료]
Bot: 탐색 종료. 단서 1개, 아이템 1개, 적 1명 처치
```

### 협력 탐색
```
Alice: @Battle [협력탐색/B4/@Bob/@Charlie]
Bot: 지하 4층 협력 탐색 시작! (3명)

Bob: @Battle [탐색]
Bot: Bob 전진... 적 조우! 클라리스 간부!

Charlie: @Battle [전투시작]
Bot: Charlie가 전투 시작!

Alice: @Battle [탐색]
Bot: Alice 전진... 아이템 발견! 비밀 열쇠

[각자 진행...]
```

---

**매일 새로운 모험이 기다립니다! 클라리스 오르를 소탕하세요!** 🗡️
